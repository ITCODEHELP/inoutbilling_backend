**Base URL**: `http://localhost:5000/api`

## Packing List

### Create Packing List
```http
POST /api/packing-list
Authorization: Bearer <token>
Content-Type: application/json
```
**Request Body**
```json
{
  "customerInformation": {
    "ms": "Acme Corp",
    "address": "123 Street",
    "contactPerson": "John Doe",
    "phone": "9876543210",
    "gstinPan": "27ABCDE1234F1Z1",
    "placeOfSupply": "Maharashtra"
  },
  "packingListDetails": {
    "prefix": "PK",
    "number": "001",
    "invoiceNumber": "INV-101",
    "invoiceDate": "2024-01-01",
    "invoiceType": "Regular"
  },
  "items": [
    {
      "productDescription": "Widget A",
      "qty": 100,
      "grossWeight": 50,
      "netWeight": 45,
      "productGroup": "Electronics"
    }
  ],
  "totals": {
    "totalPackages": 1,
    "totalGrossWeight": 50,
    "totalNetWeight": 45
  },
  "saveAndPrint": true
}
```
> **Note**: Set `saveAndPrint: true` to generate a PDF and store the URL in `pdfUrl`.

### Get Packing Lists (with Search)
```http
GET /api/packing-list?company=Acme&productGroup=Electronics&invoiceNo=INV-101&fromDate=2024-01-01&toDate=2024-12-31
Authorization: Bearer <token>
```
**Query Parameters**
- `company`, `product`, `productGroup`, `invoiceNo`, `challanNo`, `itemNote`, `remarks`, `gstin`, `invoiceType`
- `fromDate`, `toDate` (based on `invoiceDate`)
- `staffName` (resolves to staff owner)
- `page`, `limit`, `sort`, `order`

### Download Packing List PDF
```http
GET /api/packing-list/:id/download
Authorization: Bearer <token>
```

### Delete Packing List
```http
DELETE /api/packing-list/:id
Authorization: Bearer <token>
```

### Update Packing List
```http
PUT /api/packing-list/:id
Authorization: Bearer <token>
Content-Type: application/json
```
**Request Body** (Partial Update Supported)
```json
{
  "packingListDetails": {
    "prefix": "PK-NEW",
    "invoiceDate": "2024-02-01"
  },
  "items": [
    {
      "productDescription": "Updated Widget",
      "qty": 150,
      "grossWeight": 70,
      "netWeight": 65,
      "productGroup": "Electronics"
    }
  ],
  "saveAndPrint": true
}
```
> **Note**: This API supports partial updates. Fields not sent in the body will remain unchanged. Nested objects (like `packingListDetails` or `customerInformation`) are merged, meaning you can update a single field inside them without providing the whole object. Lists (like `items`) are replaced entirely if provided.

### Duplicate Packing List
```http
GET /api/packing-list/:id/duplicate
Authorization: Bearer <token>
```
**Response**
Returns a cleaned version of the packing list data with `_id`, `number`, and timestamps removed, suitable for pre-filling a new creation form.

### Print Packing List
```http
GET /api/packing-list/:id/print?original=true&duplicate=false&transport=false&office=false
Authorization: Bearer <token>
```
Renders the PDF in the browser (inline) using the professional blue grid layout.

### Download Packing List PDF
```http
GET /api/packing-list/:id/download-pdf?original=true&duplicate=true
Authorization: Bearer <token>
```
Downloads the PDF.
- **Supports Multiple IDs**: Pass comma-separated IDs (e.g., `/api/packing-list/id1,id2/download-pdf`) to get a merged PDF.
- **Query Parameters**: `original`, `duplicate`, `transport`, `office` (Booleans) to choose which copies to include.

### Share Packing List via Email
```http
POST /api/packing-list/:id/share-email
Authorization: Bearer <token>
Content-Type: application/json
```
**Request Body**
```json
{
  "email": "customer@example.com",
  "original": true,
  "duplicate": false
}
```
Sends the PDF as an attachment. If `email` is omitted, it defaults to the customer's email from the master record. Supports multiple IDs in URL.

### Share Packing List via WhatsApp
```http
POST /api/packing-list/:id/share-whatsapp
Authorization: Bearer <token>
Content-Type: application/json
```
**Request Body**
```json
{
  "phone": "9876543210",
  "original": true
}
```
Returns a `whatsappNumber` and a `deepLink` with a pre-filled message containing a secure public view link.

### Generate Public Link
```http
GET /api/packing-list/:id/public-link?original=true
Authorization: Bearer <token>
```
Returns a secure `publicLink` that can be shared with anyone to view the PDF.

### View Public Packing List
```http
GET /api/packing-list/view-public/:id/:token?original=true
```
Public endpoint to view the PDF without authentication. Requires a valid token generated by the server.
