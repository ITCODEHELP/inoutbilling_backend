**Base URL**: `http://localhost:5000/api`

## Proformas

### Custom Fields
`GET` /api/proformas/custom-fields
`POST` /api/proformas/custom-fields
`PUT` /api/proformas/custom-fields/:id
`DELETE` /api/proformas/custom-fields/:id

### Item Columns
`GET` /api/proformas/item-columns
`POST` /api/proformas/item-columns
`PUT` /api/proformas/item-columns/:id
`DELETE` /api/proformas/item-columns/:id

### List & Search
`GET` /api/proformas
- Supports Query Params:
  - `search`: Global search (Customer, No, Remarks, Product)
  - `showAll`: "true" to ignore filters
  - `company`: Search by customer name (M/S)
  - `product`: Search by product name
  - `productGroup`: Search by product group
  - `fromDate`, `toDate`: Date range for proforma date
  - `staffName`: Search by staff full name
  - `proformaNo`: Search by proforma number
  - `minAmount`, `maxAmount`: Search by grand total range
  - `lrNo`: Search by transport document number
  - `itemNote`: Search by item-level notes
  - `remarks`: Search by document remarks
  - `gstin`: Search by customer GSTIN/PAN
  - `proformaType`: Filter by type (Regular, Bill of Supply, etc.)
  - `shipTo`: Search by shipping address
  - `advanceFilter`: JSON object `{ "field": "Field Name", "operator": "operator", "value": "value" }`
  - `cf_<fieldId>`: Dynamic custom field filters.

### Summary Data
`GET` /api/proformas/summary
- Supports the same query filters as List & Search (company, product, fromDate, etc.).
- Returns:
  ```json
  {
    "success": true,
    "data": {
      "totalTransactions": 0,
      "totalCGST": 0,
      "totalSGST": 0,
      "totalIGST": 0,
      "totalTaxable": 0,
      "totalValue": 0
    }
  }
  ```

### Create (with optional Save & Print)
`POST` /api/proformas
- Body: `customerInformation`, `proformaDetails`, `transportDetails`, `items`, `totals`, `bankDetails`, `termsTitle`, `termsDetails`, `documentRemarks`, `customFields`, `print` (Boolean).

### Get Single
`GET` /api/proformas/:id

### Update
`PUT` /api/proformas/:id

### Delete
`DELETE` /api/proformas/:id

### Print PDF
`GET` /api/proformas/:id/print

### Convert to Sale Invoice
`GET` /api/proformas/:id/convert-to-invoice
- Fetches proforma data mapped for the Sale Invoice "Add" form.

### Convert to Purchase Invoice
`GET` /api/proformas/:id/convert-to-purchase-invoice
- Fetches proforma data mapped for the Purchase Invoice "Add" form.

### Convert to Delivery Challan
`GET` /api/proformas/:id/convert-to-challan
- Fetches proforma data mapped for the Delivery Challan "Add" form.

### Convert to Purchase Order
`GET` /api/proformas/:id/convert-to-purchase-order
- Fetches proforma data mapped for the Purchase Order "Add" form.

### Cancel Proforma
`POST` /api/proformas/:id/cancel
- Marks the proforma status as "Cancelled".

### Restore Proforma
`POST` /api/proformas/:id/restore
- Restores a "Cancelled" proforma to "Active" status.

### Download PDF
`GET` /api/proformas/:id/download-pdf
- Downloads the PDF(s) for the given proforma ID(s).
- Supports comma-separated IDs in the URL parameter.
- Query Params: `original`, `duplicate`, `transport`, `office` (Boolean)
- Response: PDF File attachment

### Share via Email
`POST` /api/proformas/:id/share-email
- Sends the proforma PDF(s) to the customer's email.
- Body: `{ "email": "override@example.com" }` (Optional)
- Query Params: `original`, `duplicate`, `transport`, `office` (Boolean) - Defaults to `original=true`
- Response: Success message

### Share via WhatsApp
`POST` /api/proformas/:id/share-whatsapp
- Generates a WhatsApp deep link with a public view link for the proforma.
- Body: `{ "phone": "9876543210" }` (Optional)
- Query Params: `original`, `duplicate`, `transport`, `office` (Boolean) - Defaults to `original=true`
- Response: `{ "success": true, "data": { "whatsappNumber": "...", "deepLink": "..." } }`

### Public Link (Copy Link)
`GET` /api/proformas/:id/public-link
- Generates a secure public URL for viewing the Proforma PDF.
- `id` can be a single ID or a comma-separated list of IDs for merged PDFs.
- Query Params: `original`, `duplicate`, `transport`, `office` (Booleans) - determines which copies are included in the generated link.
- **Response**:
  ```json
  {
    "success": true,
    "publicLink": "http://localhost:5000/api/proformas/view-public/1234567890abcdef/token123456?original=true"
  }
  ```

### Public View PDF (Unprotected)
`GET` /api/proformas/view-public/:id/:token
- Renders the Proforma PDF without authentication if the token is valid.
- This endpoint is publicly accessible and does not require authentication.
- The token is generated by the `public-link` endpoint and ensures secure access.

## Attachment APIs

### Attach Files
`POST` /api/proformas/:id/attach-file
- Uploads multiple files (up to 10) to a proforma.
- **Form Data**: `attachments` (file array)

### Get Attachments
`GET` /api/proformas/:id/attachments
- Retrieves all attachments linked to a proforma.

### Update (Replace) Attachment
`PUT` /api/proformas/:id/attachment/:attachmentId
- Replaces an existing attachment while preserving its reference order.
- **Form Data**: `attachment` (single file)

### Delete Attachment
`DELETE` /api/proformas/:id/attachment/:attachmentId
- Permanently deletes an attachment from the database and disk.

